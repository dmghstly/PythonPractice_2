
Справочник стран
****************

Консольное приложение для получения актуальной информации о странах.
Приложение позволяет получать из открытых источников и сохранять в файлы информацию странах и предоставлять её пользователю.
Среди возможной информации представлено:

1. Получение общей информации о стране

2. Получение данные о курсе валюты (показано сравнение с рублём)

3. Получение информации о погоде из столицы

4. Получение информации об последних популярных новостях из страны

Установка
=========

Установите требуемое ПО:

1. Docker для контейнеризации – |link_docker|

.. |link_docker| raw:: html

   <a href="https://www.docker.com" target="_blank">Docker Desktop</a>

2. Для работы с системой контроля версий – |link_git|

.. |link_git| raw:: html

   <a href="https://github.com/git-guides/install-git" target="_blank">Git</a>

3. IDE для работы с исходным кодом – |link_pycharm|

.. |link_pycharm| raw:: html

    <a href="https://www.jetbrains.com/ru-ru/pycharm/download" target="_blank">PyCharm</a>

Клонируйте репозиторий проекта в свою рабочую директорию:

    .. code-block:: console

        git clone https://github.com/mnv/python-course-country-directory.git

Использование
=============

Дополнительно устанавливались следующие библиотеки для получения информации о временной зоне и форматирования вывода в консоль

1. timezonefinder ver. 6.1.9

2. pytz ver. 2022.7.1

3. terminaltables ver. 3.1.10

4. termcolor ver 2.2.0

Перед началом использования приложения необходимо его сконфигурировать.

.. note::

    Для конфигурации выполните команды, описанные ниже, находясь в корневой директории проекта (на уровне с директорией `src`).

1. Скопируйте файл настроек `.env.sample`, создав файл `.env`:
    .. code-block:: console

        cp .env.sample .env

    Этот файл содержит преднастроенные переменные окружения, значения которых будут общими для всего приложения.
    Файл примера (`.env.sample`) содержит набор переменных со значениями по умолчанию.
    Созданный файл `.env` можно настроить в зависимости от окружения.

    .. warning::

        Никогда не добавляйте в систему контроля версий заполненный файл `.env` для предотвращения компрометации информации о конфигурации приложения.

    Чтобы получить доступ к API внешних систем, посетите соответствующие сервисы и получите токены доступа:

    * APILayer — Geography API (https://apilayer.com/marketplace/geo-api)
    * OpenWeather – Weather Free Plan (https://openweathermap.org/price#weather)
    * Newsapi – World wide news API (https://newsapi.org/)

    Задайте полученные токены доступа в качестве значений переменных окружения (в файле `.env`):

    * `API_KEY_APILAYER` – для токена доступа к APILayer
    * `API_KEY_OPENWEATHER` – для токена доступа к OpenWeather
    * `API_KEY_NEWSAPI` – для токена доступа к Newsapi

2. Соберите Docker-контейнер с помощью Docker Compose:
    .. code-block:: console

        docker compose build

    Данную команду необходимо выполнять повторно в случае обновления зависимостей в файле `requirements.txt`.

3. Чтобы просмотреть документацию по использованию консольного приложения, выполните:
    .. code-block:: console

        docker compose run app python main.py --help

    Данная команда выведет на экран список доступных аргументов и их значения по умолчанию.

4. Для запуска приложения выполните:
    .. code-block:: console

        docker compose up cron

    Запустится фоновая программа, которая будет собирать информацию о странах из различных источников и сохранять
    её в файлы в директории `media`. Процесс сбора данных запускается один раз в минуту.
    Частота обновления данных зависит от настроек в переменных:

    * `CACHE_TTL_COUNTRY` (время актуальности данных о странах)
    * `CACHE_TTL_CURRENCY_RATES` (время актуальности данных о курсах валют)
    * `CACHE_TTL_WEATHER` (время актуальности данных о погоде)
    * `CACHE_TTL_NEWS` (время актуальности данных о новостях)

    Значение для этих переменных указывается в секундах (они определяются в файле `.env`).

    После сбора всех данных можно запросить информацию о стране путем выполнения команды:

    .. code-block:: console

        docker compose run app

    Запуск можно производить с уже работающей программой для сбора данных (она работает "в фоне").
    После выполнения этой команды программа предложит ввести строку для поиска информации о стране.

    .. note::

       Для настройки параметров запуска следует передать консольной команде аргументы в соответствии с её документацией:
        .. code-block:: console

            docker compose run app python main.py --location London

        Таким образом можно определять параметры запуска в команде.

Автоматизация
=============

Проект содержит специальный файл (`Makefile`) для автоматизации выполнения команд:

1. Сборка Docker-контейнера.
2. Генерация документации.
3. Запуск форматирования кода.
4. Запуск статического анализа кода (выявление ошибок типов и форматирования кода).
5. Запуск автоматических тестов.
6. Запуск всех функций поддержки качества кода (форматирование, линтеры, автотесты).

Инструкция по запуску этих команд находится в файле `README.md`.

Тестирование
============

Для запуска автоматических тестов выполните команду:

.. code-block:: console

    docker compose run app pytest --cov=/src --cov-report html:htmlcov --cov-report term --cov-config=/src/tests/.coveragerc -vv

Также существует аналогичная `make`-команда:

.. code-block:: console

    make test

Отчет о тестировании находится в файле `src/htmlcov/index.html`.

Документация к исходному коду
*****************************

.. toctree::
   :maxdepth: 2
   :caption: Содержимое:

Запуск приложения
=================
.. automodule:: main
   :members:

.. currentmodule:: main
.. autofunction:: process_input

Сбор данных
===========
.. automodule:: collectors.collector
   :members:

Генерация выходных данных
=========================
.. automodule:: renderer
   :members:

Модели объектов
===============

.. automodule:: collectors.models
    :members:
